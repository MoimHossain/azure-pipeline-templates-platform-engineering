trigger:
  - main

resources:
  repositories:
    - repository: Platform-Engineering   # ðŸ‘ˆ alias (must match @Platform-Engineering)
      type: git
      name: Platform-Engineering/Platform-Engineering
      ref: refs/heads/main   # or a tag, strongly recommended

extends:
  template: templates/container-workloads/container-pipeline-base.yml@Platform-Engineering
  parameters:
    productName: Quadrant
    imageName: moimhossain/canary-api:$(Build.SourceVersion)
    deployEnvironmentName: quadrant-dev
    buildStepsTemplate: templates/build/build.yml@self
    buildStepsParameters:
      dockerRepository: moimhossain/canary-api
      imageTag: $(Build.SourceVersion)
      dotnetProject: src/BlueGreenFeature.csproj
      dockerfilePath: src/Dockerfile
      buildContext: $(Build.SourcesDirectory)/src
      dockerServiceConnection: DockerHub
    containerDeploymentStrategy: Canary
    canaryStrategyMode: Orchestrated
    deployStepsTemplate: templates/canary/deploy.yml@self
    canaryIncrements:
      CanaryStep_0: 20
      CanaryStep_1: 50
      CanaryStep_2: 80
    canaryStabilizationSeconds: 10
    canaryPreDeployStepsTemplate: templates/canary/predeploy.yml@self
    canaryRouteTrafficStepsTemplate: templates/canary/route-traffic.yml@self
    canaryPostRouteTrafficStepsTemplate: templates/canary/post-route.yml@self
    canarySuccessStepsTemplate: templates/canary/success.yml@self
    canaryFailureStepsTemplate: templates/canary/failure.yml@self
    canaryHealthCheckStepsTemplate: templates/canary/health-check.yml@self
    deployStepsParameters:
      kubernetesManifestPath: manifests/quadrant-orders.yml
      kubernetesNamespace: quadrant

