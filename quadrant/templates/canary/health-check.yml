parameters:
  - name: productName
    type: string
  - name: deployEnvironmentName
    type: string
  - name: stage
    type: string
    default: healthCheck
  - name: incrementPercent
    type: number
    default: 0
  - name: subscriptionId
    type: string
  - name: resourceGroup
    type: string
  - name: containerAppName
    type: string
  - name: revisionSuffix
    type: string
  - name: healthEndpoint
    type: string
    default: /api/health

steps:
    - bash: |
      set -euo pipefail
      chmod +x "$(Build.SourcesDirectory)/quadrant/templates/canary/scripts/aca-health-check.sh"
      "$(Build.SourcesDirectory)/quadrant/templates/canary/scripts/aca-health-check.sh"
    displayName: "Quadrant â€“ ACA health check"
    env:
      ENTRA_CLIENT_ID: $(ENTRA_CLIENT_ID)
      ENTRA_CLIENT_SECRET: $(ENTRA_CLIENT_SECRET)
      ENTRA_TENANT_ID: $(ENTRA_TENANT_ID)
      ACA_SUBSCRIPTION_ID: ${{ parameters.subscriptionId }}
      ACA_RESOURCE_GROUP: ${{ parameters.resourceGroup }}
      ACA_CONTAINER_APP: ${{ parameters.containerAppName }}
      ACA_REVISION_SUFFIX: ${{ parameters.revisionSuffix }}
      ACA_HEALTH_ENDPOINT: ${{ parameters.healthEndpoint }}
      INCREMENT_PERCENT: ${{ parameters.incrementPercent }}
